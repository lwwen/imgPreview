!function(){var i="<div><input type='file'/><i class='iconfont icon-upload1'></i><i class='iconfont icon-cha upload-delete'></i><span class='upload-picbg'></span></div>";jQuery.fn.extend({imgPreview:function(e){$(this).each(function(t,n){function l(i){var t,n;""==e.width&&""!=e.height?(n=e.height,t=i.css("width")):""==e.height&&""!=e.width?(t=e.width,n=i.css("height")):""!=e.height&&""!=e.width?(t=e.width,n=e.height):""==e.height&&""==e.width&&(t=i.css("width"),n=i.css("height"));var l=i.children('input[type="file"]').height(),s=i.children(".icon-upload1").width(),a=parseInt(t)-s,d=parseInt(n)-l;i.width(t),i.height(n),i.children(".icon-upload1").css({top:d/2+"px",left:a/2+"px"}),i.children('input[type="file"]').css({top:d/2+"px",left:a/2+"px",position:"absolute",opacity:0,"z-index":1e3})}function s(i,t,l){1==e.multi?$(n).data("multi")>1?d(t,t.files,l):("back-clip"==l?i.parent("div").css("background-image","url("+n.getElementsByTagName("input").getObjectURL(t.files[0])+")"):i.siblings("img").attr("src",n.getElementsByTagName("input").getObjectURL(t.files[0])),a(i.parent("div"),l)):d(t,t.files,l)}console.log(n);$.extend(e,{});e=jQuery.extend({imgType:["gif","jpeg","jpg","bmp","png"],present:"full-fill",multi:1,width:"",height:""},e||{}),$(n).append(i),l($(n).children("div")),"full-fill"==e.present||"white-space"==e.present?$(n).children("div").append("<img/>"):"back-clip"==e.present&&console.log("back-clip"),1==e.multi?$(n).data("multi")>1&&$(n).find("input").attr("multiple","multiple"):e.multi>1&&$(n).find("input").attr("multiple","multiple");var a=function(i,t){"back-clip"==t?(i.css({"background-position":"center center","background-repeat":"no-repeat","background-size":"cover"}),i.mouseenter(function(){"none"==$(this).css("background-image")||($(this).children(".upload-delete").css("display","block"),$(this).children(".upload-picbg").css("display","block"))}),i.mouseleave(function(){$(this).children(".upload-delete").css("display","none"),$(this).children(".upload-picbg").css("display","none")}),i.children(".upload-delete").click(function(){(e.multi>1||$(n).data("multi")>1)&&$(this).parent("div").remove(),$(this).parent("div").css("background-image","url()"),$(this).css("display","none"),$(this).siblings(".upload-picbg").css("display","none"),$(this).parents("div").unbind("mouseenter")})):"full-fill"==t?(i.mouseenter(function(){void 0==$(this).children("img").attr("src")||($(this).children(".upload-delete").css("display","block"),$(this).children(".upload-picbg").css("display","block"))}),i.mouseleave(function(){$(this).children(".upload-delete").css("display","none"),$(this).children(".upload-picbg").css("display","none")}),i.children(".upload-delete").click(function(){(e.multi>1||$(n).data("multi")>1)&&$(this).parent("div").remove(),$(this).siblings("img").removeAttr("src"),$(this).css("display","none"),$(this).siblings(".upload-picbg").css("display","none"),$(this).parent("div").unbind("mouseenter")})):"white-space"==t&&(i.css({"vertical-align":"middle",position:"relative",margin:"0 auto"}),i.children("img").css({"max-width":"100%","max-height":"100%",margin:"0 auto",position:"absolute",top:"50%",left:"50%",transform:"translate(-50%,-50%)",width:"auto",height:"auto"}),i.children("img").on("load",function(){$(this).width()<$(this).parent("div").width()&&$(this).height()<$(this).parent("div").height()&&$(this).width($(this).parent("div").width())}),i.mouseenter(function(){void 0!=$(this).children("img").attr("src")&&($(this).children(".upload-delete").css("display","block"),$(this).children(".upload-picbg").css("display","block"))}),i.mouseleave(function(){$(this).children(".upload-delete").css("display","none"),$(this).children(".upload-picbg").css("display","none")}),i.children(".upload-delete").click(function(){(e.multi>1||$(n).data("multi")>1)&&$(this).parent("div").remove(),$(this).siblings("img").removeAttr("src"),$(this).siblings("img").width(""),$(this).css("display","none"),$(this).siblings(".upload-picbg").css("display","none"),$(this).parent("div").unbind("mouseenter")}))};n.getElementsByTagName("input").getObjectURL=function(i){var e=null;return void 0!=window.createObjectURL?e=window.createObjectURL(i):void 0!=window.URL?e=window.URL.createObjectURL(i):void 0!=window.webkitURL&&(e=window.webkitURL.createObjectURL(i)),e};var d=function(e,t,s){for(var d=0;d<t.length;d++){var c=$(e).parents("div").children("div");console.log(c);$(e).parent("div").index();$(e).parents(".img-preview-wrap").prepend(i);var r=$(e).parents("div").children("div").eq(0);l(r),"back-clip"==s?(r.css("background-image","url("+n.getElementsByTagName("input").getObjectURL(t[d])+")"),a(r,s)):(r.append("<img/>"),r.children("img").attr("src",n.getElementsByTagName("input").getObjectURL(t[d])),a(r,s))}};$(n).find('input[type="file"]').click(function(i){var t=$(n).children("div").length;if(1==e.multi){if(void 0!=$(n).data("multi")&&t>$(n).data("multi"))return alert("超过了"+$(n).data("multi")+"张限制了"),!1;if(void 0==$(n).data("multi")&&t>e.multi)return alert("超过了"+e.multi+"张限制了"),!1}else if(e.multi>1&&t>e.multi)return alert("上传超过"+e.multi+"张了,预览失败"),!1});var c=0;$(n).find('input[type="file"]').change(function(i){if(1==e.multi){if(void 0!=$(n).data("multi")&&i.target.files.length>$(n).data("multi")-c)return console.log("这里3"),alert("超过了"+$(n).data("multi")+"张限制了"),!1;if(void 0==$(n).data("multi")&&i.target.files.length>e.multi)return console.log("这里2"),alert("超过了"+e.multi+"张限制了"),!1}else if(e.multi>1&&i.target.files.length>e.multi-c)return console.log("zheli"),alert("超过了"+e.multi+"张限制了"),!1;if(c=i.target.files.length,"full-fill"==e.present?void 0!=$(n).data("present")?"white-space"==$(n).data("present")?s($(this),this,"white-space"):"back-clip"==$(n).data("present")&&s($(this),this,"back-clip"):void 0==$(n).data("present")&&s($(this),this,e.present):"white-space"==e.present?s($(this),this,"white-space"):"back-clip"==e.present&&s($(this),this,"back-clip"),$(this).wrap("<form>").closest("form").get(0).reset(),$(this).unwrap("<form>"),this.value&&!RegExp(".("+e.imgType.join("|")+")$","i").test(this.value.toLowerCase()))return alert("选择文件错误，图片类型必须是"+e.imgType.join(",")+"中的一种"),this.value="",!1})})}})}();