!function(){var i="<div><input type='file'/><i class='iconfont icon-upload1'></i><i class='iconfont icon-cha upload-delete'></i><span class='upload-picbg'></span></div>";jQuery.fn.extend({imgPreview:function(e){$(this).each(function(t,l){function n(i){var t,l;""==e.width&&""!=e.height?(l=e.height,t=i.css("width")):""==e.height&&""!=e.width?(t=e.width,l=i.css("height")):""!=e.height&&""!=e.width?(t=e.width,l=e.height):""==e.height&&""==e.width&&(t=i.css("width"),l=i.css("height"));var n=i.children('input[type="file"]').height(),s=i.children(".icon-upload1").width(),a=parseInt(t)-s,d=parseInt(l)-n;i.width(t),i.height(l),i.children(".icon-upload1").css({top:d/2+"px",left:a/2+"px"}),i.children('input[type="file"]').css({top:d/2+"px",left:a/2+"px",position:"absolute",opacity:0,"z-index":1e3})}function s(i){$(l).find('input[type="file"]').change(function(t){if(1==e.multi){if(void 0!=$(l).data("multi")&&t.target.files.length>$(l).data("multi")-i+1)return console.log("这里3"),alert("超过了"+$(l).data("multi")+"张限制了"),!1;if(void 0==$(l).data("multi")&&t.target.files.length>e.multi)return console.log("这里2"),alert("超过了"+e.multi+"张限制了"),!1}else if(e.multi>1&&t.target.files.length>e.multi-i+1)return console.log("zheli"),alert("超过了"+e.multi+"张限制了"),!1})}function a(i,t,n){1==e.multi?$(l).data("multi")>1?c(t,t.files,n):("back-clip"==n?i.parent("div").css("background-image","url("+l.getElementsByTagName("input").getObjectURL(t.files[0])+")"):i.siblings("img").attr("src",l.getElementsByTagName("input").getObjectURL(t.files[0])),o(i.parent("div"),n)):c(t,t.files,n)}console.log(l),$.extend(e,{}),e=jQuery.extend({imgType:["gif","jpeg","jpg","bmp","png"],present:"full-fill",multi:1,width:"",height:""},e||{});var d=0;$(l).append(i),n($(l).children("div")),"full-fill"==e.present||"white-space"==e.present?$(l).children("div").append("<img/>"):"back-clip"==e.present&&console.log("back-clip"),1==e.multi?$(l).data("multi")>1&&$(l).find("input").attr("multiple","multiple"):e.multi>1&&$(l).find("input").attr("multiple","multiple");var o=function(i,t){"back-clip"==t?(i.css({"background-position":"center center","background-repeat":"no-repeat","background-size":"cover"}),i.mouseenter(function(){"none"==$(this).css("background-image")||($(this).children(".upload-delete").css("display","block"),$(this).children(".upload-picbg").css("display","block"))}),i.mouseleave(function(){$(this).children(".upload-delete").css("display","none"),$(this).children(".upload-picbg").css("display","none")}),i.children(".upload-delete").click(function(){if(d++,e.multi>1||$(l).data("multi")>1){$(this).parent("div").remove();var i=$(l).children("div").length;console.log("当前div"+i),s(i),console.log("count"+d)}$(this).parent("div").css("background-image","url()"),$(this).css("display","none"),$(this).siblings(".upload-picbg").css("display","none"),$(this).parents("div").unbind("mouseenter")})):"full-fill"==t?(i.mouseenter(function(){void 0==$(this).children("img").attr("src")||($(this).children(".upload-delete").css("display","block"),$(this).children(".upload-picbg").css("display","block"))}),i.mouseleave(function(){$(this).children(".upload-delete").css("display","none"),$(this).children(".upload-picbg").css("display","none")}),i.children(".upload-delete").click(function(){if(d++,e.multi>1||$(l).data("multi")>1){$(this).parent("div").remove();var i=$(l).children("div").length;console.log("当前div"+i),s(i)}$(this).siblings("img").removeAttr("src"),$(this).css("display","none"),$(this).siblings(".upload-picbg").css("display","none"),$(this).parent("div").unbind("mouseenter")})):"white-space"==t&&(i.css({"vertical-align":"middle",position:"relative",margin:"0 auto"}),i.children("img").css({"max-width":"100%","max-height":"100%",margin:"0 auto",position:"absolute",top:"50%",left:"50%",transform:"translate(-50%,-50%)",width:"auto",height:"auto"}),i.children("img").on("load",function(){$(this).width()<$(this).parent("div").width()&&$(this).height()<$(this).parent("div").height()&&$(this).width($(this).parent("div").width())}),i.mouseenter(function(){void 0!=$(this).children("img").attr("src")&&($(this).children(".upload-delete").css("display","block"),$(this).children(".upload-picbg").css("display","block"))}),i.mouseleave(function(){$(this).children(".upload-delete").css("display","none"),$(this).children(".upload-picbg").css("display","none")}),i.children(".upload-delete").click(function(){if(d++,e.multi>1||$(l).data("multi")>1){$(this).parent("div").remove();var i=$(l).children("div").length;console.log("当前div"+i),s(i)}$(this).siblings("img").removeAttr("src"),$(this).siblings("img").width(""),$(this).css("display","none"),$(this).siblings(".upload-picbg").css("display","none"),$(this).parent("div").unbind("mouseenter")}))};l.getElementsByTagName("input").getObjectURL=function(i){var e=null;return void 0!=window.createObjectURL?e=window.createObjectURL(i):void 0!=window.URL?e=window.URL.createObjectURL(i):void 0!=window.webkitURL&&(e=window.webkitURL.createObjectURL(i)),e};var c=function(e,t,s){for(var a=0;a<t.length;a++){var d=$(e).parents("div").children("div");console.log(d),$(e).parent("div").index(),$(e).parents(".img-preview-wrap").prepend(i);var c=$(e).parents("div").children("div").eq(0);n(c),"back-clip"==s?(c.css("background-image","url("+l.getElementsByTagName("input").getObjectURL(t[a])+")"),o(c,s)):(c.append("<img/>"),c.children("img").attr("src",l.getElementsByTagName("input").getObjectURL(t[a])),o(c,s))}};$(l).find('input[type="file"]').click(function(i){var t=$(l).children("div").length;if(1==e.multi){if(void 0!=$(l).data("multi")&&t>$(l).data("multi"))return alert("超过了"+$(l).data("multi")+"张限制了"),!1;if(void 0==$(l).data("multi")&&t>e.multi)return alert("超过了"+e.multi+"张限制了"),!1}else if(e.multi>1&&t>e.multi)return alert("上传超过"+e.multi+"张了,预览失败"),!1});var r=0;$(l).find('input[type="file"]').change(function(i){if(console.log("chenge"+d),0==d)if(console.log("ddd"),console.log(r),1==e.multi){if(void 0!=$(l).data("multi")&&i.target.files.length>$(l).data("multi")-r)return console.log("这里3"),alert("超过了"+$(l).data("multi")+"张限制了"),!1;if(void 0==$(l).data("multi")&&i.target.files.length>e.multi)return console.log("这里2"),alert("超过了"+e.multi+"张限制了"),!1}else if(e.multi>1&&i.target.files.length>e.multi-r)return console.log("zheli"),alert("超过了"+e.multi+"张限制了"),!1;if(r=i.target.files.length,console.log(r),console.log("现在是"+r+"张图了"),"full-fill"==e.present?void 0!=$(l).data("present")?"white-space"==$(l).data("present")?a($(this),this,"white-space"):"back-clip"==$(l).data("present")&&a($(this),this,"back-clip"):void 0==$(l).data("present")&&a($(this),this,e.present):"white-space"==e.present?a($(this),this,"white-space"):"back-clip"==e.present&&a($(this),this,"back-clip"),$(this).wrap("<form>").closest("form").get(0).reset(),$(this).unwrap("<form>"),this.value&&!RegExp(".("+e.imgType.join("|")+")$","i").test(this.value.toLowerCase()))return alert("选择文件错误，图片类型必须是"+e.imgType.join(",")+"中的一种"),this.value="",!1})})}})}();